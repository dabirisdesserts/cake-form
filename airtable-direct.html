<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dabiri's Desserts - Order Form</title>
    <style>
        /* Copy all your existing CSS here */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        /* ... rest of your CSS ... */
    </style>
</head>
<body>
    <!-- Copy all your existing HTML content here -->
    <div class="container">
        <!-- Your existing form content -->
    </div>

    <script>
        // Direct Airtable integration for GitHub Pages
        const AIRTABLE_CONFIG = {
            apiKey: 'YOUR_AIRTABLE_API_KEY', // Replace with your actual API key
            baseId: 'YOUR_BASE_ID', // Replace with your actual base ID
            tableId: 'YOUR_TABLE_ID' // Replace with your actual table ID
        };

        document.getElementById('dessertOrderForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;

            try {
                const formData = collectFormData();
                const orderId = generateOrderId();
                const total = calculateTotal(formData.products, formData.pickupDate);

                // Prepare Airtable data
                const airtableData = {
                    fields: {
                        "Order ID": orderId,
                        "Customer Name": `${formData.firstName} ${formData.lastName}`,
                        "Email": formData.email,
                        "Phone Number": formData.phone,
                        "Pickup Date": formData.pickupDate,
                        "Order Details": JSON.stringify(formData.products || []),
                        "Special Instructions": formData.specialInstructions || formData.customItems || '',
                        "Total Price": total,
                        "Order Status": "Submitted",
                        "Order Date": new Date().toISOString().split('T')[0]
                    }
                };

                // Submit to Airtable
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(airtableData)
                });

                if (response.ok) {
                    showSuccessMessage(orderId, total);
                } else {
                    const error = await response.json();
                    throw new Error(`Airtable error: ${error.error?.message || 'Unknown error'}`);
                }

            } catch (error) {
                console.error('Error submitting order:', error);
                alert('Error submitting order. Please try again or contact us directly.');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        function generateOrderId() {
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substr(2, 5);
            return `DD-${timestamp}-${random}`.toUpperCase();
        }

        function calculateTotal(products, pickupDate) {
            let total = 0;

            if (products) {
                products.forEach(product => {
                    total += (product.price || 0) * (product.quantity || 1);
                });
            }

            // Add rush fee if pickup is within 10 days
            const pickup = new Date(pickupDate);
            const today = new Date();
            const daysUntilPickup = Math.ceil((pickup - today) / (1000 * 60 * 60 * 24));

            if (daysUntilPickup < 10) {
                total += 20; // Rush fee
            }

            return total;
        }

        function showSuccessMessage(orderId, total) {
            // Your existing success message function
            alert(`Order submitted successfully! Order ID: ${orderId}, Total: $${total}`);
        }

        // Your existing collectFormData function
        function collectFormData() {
            // Your existing implementation
        }
    </script>
</body>
</html>
